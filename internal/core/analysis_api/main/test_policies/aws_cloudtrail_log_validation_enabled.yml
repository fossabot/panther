# Copyright 2020 Panther Labs Inc
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

AnalysisType: policy
AutoRemediationParameters:
  hello: goodbye
Filename: aws_cloudtrail_log_validation_enabled.py
PolicyID: AWS.CloudTrail.Log.Validation.Enabled 
Enabled: true
ResourceTypes:
  - AWS.CloudTrail 
Tags:
  - AWS Managed Rules - Management and Governance 
  - CIS
Severity: Medium 
Description: >
  This rule validates that AWS CloudTrails have log file validation enabled.
Runbook: >
  Runbook
Reference: reference.link 
Tests:
  -
    Name: Log File Validation Disabled
    ResourceType: AWS.CloudTrail
    ExpectedResult: false
    Resource:
      {
        "Info": {
          "LogFileValidationEnabled": false
        },
        "EventSelectors": [
          {
            "DataResources": [
              {
                "Type": "AWS::S3::Object",
                "Values": null
              }
            ],
            "IncludeManagementEvents": false,
            "ReadWriteType": "All"
          }
        ]
      }
  -
    Name: Log File Validation Enabled
    ResourceType: AWS.CloudTrail
    ExpectedResult: true
    Resource:
      {
        "Info": {
          "LogFileValidationEnabled": true
        },
        "Bucket": {
          "CreationDate": "2019-01-01T00:00:00Z",
          "Grants": [
            {
              "Grantee": {
                "URI": null
              },
              "Permission": "FULL_CONTROL"
            }
          ],
          "Owner": {
            "DisplayName": "panther-admins",
            "ID": "longalphanumericstring112233445566778899"
          },
          "Versioning": null
        },
        "EventSelectors": [
          {
            "DataResources": [
              {
                "Type": "AWS::S3::Object",
                "Values": null
              }
            ],
            "ReadWriteType": "All"
          }
        ]
      }
